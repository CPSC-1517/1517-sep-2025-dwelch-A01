@page "/singlequery"
<PageTitle>Single Query</PageTitle>

<!-- 
    REMEMBER:!!!!!!!!!!!!! 
    You need the following statement so your buttons will respond
-->
@rendermode InteractiveServer

<!-- Additional Namespaces-->
@using WestWindSystem.BLL
@using WestWindSystem.Entities;

<h1>Region: Single Query</h1>
<cite>... the single record query from the database</cite>

@if (feedBackMsg.Length > 0)
{
    <div class="alert alert-info">
        <p>@feedBackMsg</p>
    </div>
}

@if (errorMsgs.Count > 0)
{
    <div class="alert alert-danger">
        <p>Please fix the following issues:</p>
        <ul>
            @foreach (var error in errorMsgs)
            {
                <li>@error</li>
            }
        </ul>
    </div>
}

<br/><br/>
<!-- create the form for the query-->
@*
    form area
    standard html controls
    use bootstrap for formatting
    form will be two column
*@

<div class="row">
    <div class="col-md-6">
        <!-- this column will hold the query input controls and buttons-->
        <p><strong>Input query controls and buttons</strong></p>

        <label for="regionid">Enter a region id:</label>&nbsp;&nbsp;
        <input id="regionid" type="number" @bind="entryarg"
            placeholder="enter id" style="width:100px;" />&nbsp;&nbsp;
        <button type="submit" @onclick="GetByEntry"
                class="btn btn-outline-primary rounded-pill"
                style="width:170px">
            Fetch By Entry   
        </button>

        <br/><br/>
        <label for="selectid">Select a region:</label>&nbsp;&nbsp;
        <select id="selectid" @bind="selectionarg">
            <option value="0">... select ...</option>
            <!-- 
                this collection for the loop will be a collection returned
                    from the database 
                remember this should ONLY be consider IF your collection
                    for the control is samll, consider an upper limit of 100 records
            -->
            @foreach (var item in regionList)
            {
                <option value="@item.RegionID">@item.RegionDescription</option>
            }
        </select>&nbsp;&nbsp;
        <button type="submit" @onclick="GetBySelection"
                class="btn btn-outline-secondary rounded-pill"
                style="width:170pxpx">
            Fetch By Selection
        </button>
    </div>
    <div class="col-md-6">
        <!-- this column will hold the query result output
             no output attempt will be done unless the page actually
                has something to display
        -->
        @if(info != null)
        {
            <p>this is the output display column</p>
            <br/>
            <p>Region id: @info.RegionID</p>
            <p>Region Description: @info.RegionDescription</p>
        }
    </div>
</div>
@code {
    private string feedBackMsg = "";
    private List<string> errorMsgs = new();

    //variable for binding
    private int entryarg = 0;
    private int selectionarg = 0;

    //variables to hold data from database
    private List<Region> regionList = new();
    private Region info = null;

    //inject any needed services
    [Inject]
    public RegionServices _regionServices { get; set; }


    protected override void OnInitialized()
    {
        base.OnInitialized();

        //load the collection required by the select control
        //  so that the options appear
        regionList = _regionServices.Region_GetAll();
    }
    //event methods (the onclick of your buttons)
    public void GetByEntry()
    {
        //clear all old messages
        feedBackMsg ="";
        errorMsgs.Clear();

        //validate incoming data
        if (entryarg <= 0)
        {
            //you can either use feedbackMsg or errorMsgs
            feedBackMsg = $"Your region {entryarg} is invalid. Enter a value greater than 0.";
        }
        else
        {
            //remember that you are leaving this project to another system
            //  which could possible throw an exception
            //this means that as you consume a service you should remember to
            //  implement user freindly error handling

            try
            {
                //data is deemed valid
                //consume a service: Region_GetByID
                info= _regionServices.Region_GetByID(entryarg);

                //remember to communicate with your user
                if (info == null)
                {
                    feedBackMsg = $"There is no data for the region id: {entryarg}";
                }
            }
            catch (Exception ex)
            {
                errorMsgs.Add($"System Error: {ex.Message}");
            }

        }
    }

    public void GetBySelection()
    {
        //clear all old messages
        feedBackMsg ="";
        errorMsgs.Clear();

        //validate incoming data
        if (selectionarg == 0) //is the drop down list still on the prompt
        {
            //you can either use feedbackMsg or errorMsgs
            feedBackMsg = $"You must select a region to view.";
        }
        else
        {
            try
            {
                //data is deemed valid
                //consume a service: Region_GetByID
                info= _regionServices.Region_GetByID(selectionarg);

                //remember to communicate with your user
                if (info == null)
                {
                    feedBackMsg = $"There is no data for the selected region";
                }
            }
            catch (Exception ex)
            {
                errorMsgs.Add($"System Error: {ex.Message}");
            }
        }
    }
}
